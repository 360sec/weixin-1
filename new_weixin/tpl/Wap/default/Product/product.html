<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="format-detection" content="telephone=no"/>
<title>{ZF:$metaTitle}</title>
<script src="{ZF::$staticFilePath}/js/jquery-1.9.1.min.js" type="text/javascript"></script>

<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap-theme.css">
<script type="text/javascript" src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
 
<script src="{ZF::$staticFilePath}/js/jquery.lazyload.js" type="text/javascript"></script>
<script src="{ZF::$staticFilePath}/js/notification.js" type="text/javascript"></script>
<script src="{ZF::$staticFilePath}/js/swiper.min.js" type="text/javascript"></script>
<script src="{ZF::$staticFilePath}/js/main.js" type="text/javascript"></script>
<link type="text/css" rel="stylesheet" href="{ZF::$staticFilePath}/css/style_touch.css">
</head>
<script>
$(document).ready(function(){
$(".m-hd .cat").parent('div').click( function() {
    var docH=$(document).height();
  	$('.sub-menu-list').toggle();
    $(".m-right-pop-bg2").addClass("on").css('min-height',docH);
});
$(".m-right-pop-bg2").click( function() {
    $('.sub-menu-list').hide();
   $(".m-right-pop-bg2").removeClass("on").removeAttr("style");
});
});
</script>
<style>
#content{display:none;width:100%;overflow:hidden;position:absolute;top:0}#imgs{-webkit-transition-property:-webkit-transform;-webkit-transition-duration:0.5s;-webkit-transition-timing-function:ease-out;-webkit-transform:translate3d(0px,0px,0px);height:100%}#imgs li{float:left;text-align:center;height:100%;padding-top:65px}#imgs img{width:94%;-webkit-transform:translate3d(0px,0px,0px)}.bg{width:100%;top:0;left:0;background:#000;opacity:0.8;position:absolute;display:none}.close{display:none;position:absolute;z-index:10;right:3%;top:20px;color:#fff;cursor:pointer;background:#999;border-radius:3px;padding:5px 8px}.s_count{display:none;position:absolute;z-index:10;right:3%;top:25px;color:#fff;margin-right:60px}
.infodetail img{
    max-width: 300px;
}
.detail-info img{
	width:100%;
}

body{font-family: '微软雅黑';margin:0;padding: 0;}
.focusPic img{width:100%;height:auto;}
//.m-detail-mainout .focusPic .views img{max-height:100%;}
.m-detail-mainout .focusPic{max-height: 640px;}
.m-detail-mainout .focusPic .views img{max-height:none;}
.bottom_nav{position: fixed;height:50px;background: #eee;bottom:0;z-index: 100;width:100%;box-shadow:1px 1px 10px #ccc;}
.line{height:10px;background: #f8f8f8;}
.m-hd a{border-left: none;border:1px solid #e2e2e2;}
.m-hd{height:50px;border-bottom: none;background:#eee;display: inline-block;width:60px;}
.m-hd div a.cart:after{width:100%;height: 100%;top:0px;left:0;color:black;background: url(/tpl/Wap/default/common/css/product/css/img/cart2.png) no-repeat;background-color: white;}
.buynow{background:#f69555;color:#fff;font-size:1.4rem;padding:10px 20px;border-radius:5px;}
.addcart{background:#ff5366;color:#fff;font-size:1.4rem;padding:10px 20px;border-radius:5px;}
.m-detail-mainout .d-info .price{padding:10px 0;border:none;border-bottom: .1rem solid #eee;font-family: '微软雅黑';}
.m-detail-mainout .d-info h1{padding:0;}
.m-detail-mainout .d-info .i-row .t{width:auto;}
.detailinfo .tabs{background: white;border-bottom: 3px solid #f8f8f8;}
.m-detail-mainout .focusPic{margin-top:0;}
.all{margin-bottom: 30px;}
.m-body{min-width:200px;}

#top_div{ position:fixed; bottom:80px; right:0; display:none; } 
.m-detail-mainout .d-info h1{margin-top:0;}
ul{margin-bottom:5px;}
.show{display: inline-block!important;}
.focusPic{top:-10px;}

.detailinfo a:HOVER {text-decoration: none;color:#333;} 
ul{margin-bottom: 5px;margin-top:5px;}
.detailinfo .tabs{border:none;}
.m-detail-mainout .d-info .i-row .buynum i:after, .m-detail-mainout .d-info .i-row .buynum i.add:before{top:1.2rem;left:.9rem;}
.m-detail-mainout .d-info .i-row .buynum i {height:3rem;width: 3rem;}
.m-detail-mainout .d-info .i-row .buynum input{height:3rem;}
.bottom_nav i.cart_com{box-shadow:0 0 1px #900 inset;text-indent:0;position:absolute;top:0px;right:5px;z-index:1;background:#FF9;color:#966;border-radius:20px;font-size:10px;padding:0px 3px;font-weight:700;}
.PhonePhotoUpload_image{margin-bottom:15px;}

</style>
<body>
<!--  -->
<div class="all"  name="top">
<div id="scnhtm5" class="m-body">
	<div class="m-detail-mainout">

<!--轮播--->
		<div class="focusPic">
			<div class="views">
				<if condition="$imageList">
					<ul class="warp" id="fd">
						<volist name="imageList" id="img">
						<li class="li"><img src="{ZF:$img.image}"></li>
						</volist>
					</ul>
				<else/>
					<ul class="warp" id="fd">
						<li class="li"><img src="{ZF:$product.logourl}"></li>
					</ul>
				</if>
			</div>
			<if condition="$imageList">
				<ul class="tabs">
					<volist name="imageList" id="img" key="i">
					<li class="li">{ZF:$i}</li>
					</volist>
				</ul>
			<else/>
				<ul class="tabs"><li>0</li></ul>
			</if>
		</div>
<script>
var focusPic = new Swiper('.focusPic .views',{pagination: '.focusPic .tabs',autoplay:3000})
</script>
<!--轮播结束--->
		<div class="d-info">
			<form id="product_buy_form" name="product_buy_form" action="#" method="POST">
				<h1>{ZF:$product.name}</h1>
				<div class="price">
				<span class="okp">销售价：<em id="xsprice">￥{ZF:$product.price}</em></span>
				<span class="okp">会员价：<em id="vprice">￥<php>if ($product['vprice'] > 0) {echo $product['vprice'];} else {echo $product['price'];}</php></em></span>
				<span>市场价：<i>￥{ZF:$product.oprice}</i></span>
				</div>
				<div style="display:none;" class="price">促销：<font color="red">新春热卖~~~</font></div>
				<if condition="$colorData and $catData['color']">
					<div class="i-row">
						<div class="t">{ZF:$catData.color}：</div>
							<div class="c">
								<ul class="ys cm">
									<volist name="colorData" id="detail" key="colorId">
										<li style="cursor:pointer" class="color" id="color_{ZF:$detail['color']}">
											<if condition="$detail['logo'] neq ''"><img src="{ZF:$detail['logo']}"><else/>{ZF:$detail['colorName']}</if>
										</li>
									</volist>
								</ul>
						</div>
					</div>
				</if>
				<if condition="$formatData and $catData['norms']">
					<div class="i-row">
						<div class="t">{ZF:$catData.norms}：</div>
						<div class="c">
							<ul id="shoe_size_list" class="ys cm">
								<volist name="formatData" id="detail" key="formatId">
									<li style="cursor:pointer" class="norms" id="norms_{ZF:$detail['format']}">{ZF:$detail['formatName']}</li>
								</volist>
							</ul>
						</div>
					</div>
				</if>
				
				<volist name="productDetail" id="pro">
					<input type="hidden" id="color_{ZF:$pro.color}_norms_{ZF:$pro.format}" value="{ZF:$pro.num}" did="{ZF:$pro.id}" price="{ZF:$pro.price}" vprice="{ZF:$pro.vprice}" class="hidden"/>
				</volist>
				<div class="i-row">
					<div class="t">数量：</div>
					<div class="c buynum">
						<i style="cursor: pointer;" class="numadjust dec" onclick="plus_minus({ZF:$product.id}, -1,{ZF:$product.price})"></i>
							<input id="buy_num" name="goods[num]" type="text" value="1" style="line-height: 2rem;">
						<i style="cursor: pointer;" class="numadjust add" onclick="plus_minus({ZF:$product.id},1,{ZF:$product.price})"></i>
						<span class="stock">(库存<span id="stock">{ZF:$product.num}</span>)</span>
					</div>
				</div>
				<div class="i-row">
				<div class="t">邮费：</div>
				<div class="c buynum">
					<span class="stock">
						<if condition="$product['mailprice'] eq '0'">
							卖家包邮
						<else/>
							￥{ZF:$product.mailprice}
						
						</if>
					</span>
				</div>
				</div>
					<div id="show_msg" style="display:none;" class="error"></div>
			</form>
		</div>
	</div>

	<div class="line"></div>
	
	<div><a href="{ZF::U('Muser/Product/product_edit',array('id'=>$product['id'],'mode'=>'import'))}">复制到我的店铺</a></div>
	
	<div class="m-detail-mainout">
		<div class="back_shop" style="line-height:27px;font-family: '微软雅黑';font-size:14px;margin-top:5px;margin-bottom:5px;">
			<a href="{ZF::U('Product/cats',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}">
				<div style="width:30px;height:30px;display: inline-block;margin-left: 10px;">
					<img src="{ZF:$wxuser.headerpic}" style="width:100%;height: 100%;">
				</div>
				<div style="display:inline-block;padding-left: 5px;">{ZF:$wxuser.wxname}</div>
				<div style="display:inline-block;float: right;padding-right: 10px;color:#666;padding-top:3px;">进入店铺</div>
			</a>
		</div>
	</div>	
	<div class="line"></div>
<div class="m-detail-mainout">
	<div class="d-info" style="margin: 0;">
	<div class="detailinfo" style="padding:0;">
		<a href="#goods_detail">
			<ul class="tabs">
				<li style="text-align: left;padding-left: 10px;font-size: 16px;border:none;">图文详情</li>
				<li style="text-align: right;padding-right: 10px;font-size: 16px;border:none"><span class="glyphicon glyphicon-chevron-right"></span></li>
			</ul>
		</a>
		<div class="line" style="background: #f0f0f0;"></div>
		<div class="detail_title">
			<ul class="tabs">
				<li style="text-align: center;padding-left: 10px;font-size: 14px;width:33%;color:#d91100">商品介绍</li>
				<li style="text-align: center;padding-left: 10px;font-size: 14px;width:33%"></li>
				<li style="text-align: center;padding-left: 10px;font-size: 14px;width:33%"></li>
			</ul>
		</div>
		<div class="line" style="height:3px;"></div>
		<div class="views"  style="padding:10px;"><a name="goods_detail"></a>
			<div class="warp">
				<div class="li">
					<ul class="detail-list">
					<!--  <li>{ZF:$product.name}</li>-->
					<volist name="attributeData" id="attribute">
					<li><label>{ZF:$attribute.name}：</label><span>{ZF:$attribute.value}</span></li>
					</volist>
					</ul>
                    <div class="detail-info" style="line-height:1.5;">
                    {ZF:$product.intro}
                    </div>
					<!-- <div class="m-page more_detailinfo">
						<div class="pg-num"><a href="{ZF::U('Product/productDetail',array('token'=>$_GET['token'],'id'=>$product['id'],'wecha_id'=>$_GET['wecha_id']))}">查看图文详情</a></div>
					</div>
					<div style="display:none;" class="m-page hide_detailinfo">
						<div class="pg-num"><a href="javascript:void(0);">收起图文详情</a></div>
					</div>
					<div class="goods_intro"></div> -->
				</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript"> 
//var detailinfo = new Swiper('.detailinfo .views',{pagination: '.detailinfo .tabs',autoplay:false});
var SysSecond; 
var InterValObj; 
var buyDetailId = '';
$(document).ready(function() {
	SysSecond = parseInt($("#remainSeconds").html()); //这里获取倒计时的起始时间 
	InterValObj = window.setInterval(SetRemainTime, 1000); //间隔函数，1秒执行 
	$(".color").click(function(){
		if ($(this).attr('class') != 'color on') {
			$(this).addClass('on').siblings().removeClass('on');
			var id = $(this).attr('id');
			var nextid = 'norms_0';
			$('.norms').each(function(){
				if ($(this).attr('class') == 'norms on') {
					nextid = $(this).attr('id');
				}
			});
			if ($("#" + id + "_" + nextid).val() != null && $("#" + id + "_" + nextid).val() != '') {
				buyDetailId = id + "_" + nextid;
				$("#stock").text($("#" + id + "_" + nextid).val());
				$("#xsprice").text('￥' + $("#" + id + "_" + nextid).attr('price'));
				$("#vprice").text('￥' + $("#" + id + "_" + nextid).attr('vprice'));
			} else {
				$("#stock").text(0);
			}
		} else {
			$(this).removeClass('on');
		}
	});
	$(".norms").click(function(){
		if ($(this).attr('class') != 'norms on') {
			$(this).addClass('on').siblings().removeClass('on');
			var id = $(this).attr('id');
			var nextid = 'color_0';
			$('.color').each(function(){
				if ($(this).attr('class') == 'color on') {
					nextid = $(this).attr('id');
				}
			});
			if ($("#" + nextid + "_" + id).val() != '' && $("#" + nextid + "_" + id).val() != null) {
				buyDetailId = nextid + "_" + id;
				$("#stock").text($("#" + nextid + "_" + id).val());
				$("#xsprice").text('￥' + $("#" + nextid + "_" + id).attr('price'));				
				$("#vprice").text('￥' + $("#" + nextid + "_" + id).attr('vprice'));
			} else {
				$("#stock").text(0);
			}
		} else {
			$(this).removeClass('on');
		}
	});
}); 

//将时间减去1秒，计算天、时、分、秒 
function SetRemainTime() {
	if (SysSecond > 0) { 
		SysSecond = SysSecond - 1; 
		var second = Math.floor(SysSecond % 60);             // 计算秒     
		var minite = Math.floor((SysSecond / 60) % 60);      //计算分 
		var hour = Math.floor((SysSecond / 3600) % 24);      //计算小时 
		var day = Math.floor((SysSecond / 3600) / 24);        //计算天 
		$("#remainTime").html('&nbsp;&nbsp;还剩'+day + "天" + hour + "小时" + minite + "分" + second + "秒"); 
	} else {//剩余时间小于或等于0的时候，就停止间隔函数 
		window.clearInterval(InterValObj); 
		//这里可以添加倒计时时间为0后需要执行的事件 
	} 
}
//加减
function plus_minus(rowid, number,price) {
    var num = parseInt($('#buy_num').val());
    num = num + parseInt(number);
    if (num > parseInt($('#stock').text())) {
    	num = parseInt($('#stock').text());
    }
    if (num < 0) {
        return false;
    }
     $('#buy_num').attr('value',num);
}
function add_cart() {
	$("#btn_add_cart").attr("disable", false);
	var count = parseInt($('#buy_num').val());
	var did = parseInt($("#" + buyDetailId).attr('did'));
	if ($('.hidden').eq(0).val() != null && $('.hidden').eq(0).val() != '' && $('.hidden').eq(0).val() != 'undefined') {
		if (isNaN(did)) {
	        return floatNotify.simple('请选择颜色与尺码');
		}
	} else {
		did = 0;
	}
	if (count > parseInt($("#stock").text())) {
		return floatNotify.simple('抱歉，您的购买量超过了库存了');
	}
	$.ajax({
		url: "{ZF::U('Product/addProductToCart',array('token'=>$token,'id'=>$product['id'],'wecha_id'=>$_GET['wecha_id']))}" + '&count='+count + '&did=' + did,
		success: function(data) {
			if(data){
				var datas=data.split('|');
                $('.cart_com').text(datas[0]); 
                $("#btn_add_cart").attr("disable", true);
                return floatNotify.simple('加入购物车成功');
			} else {
				return floatNotify.simple('抱歉，您的请求不正确');
			}
		}
	});
}
function QuickBuy() {
	var count = parseInt($('#buy_num').val());
	var did = parseInt($("#" + buyDetailId).attr('did'));
	if ($('.hidden').eq(0).val() != null && $('.hidden').eq(0).val() != '' && $('.hidden').eq(0).val() != 'undefined') {
		if (isNaN(did)) {
			return floatNotify.simple('请选择颜色与尺码');
			return false;
		}
	} else {
		did = 0;
	}
	if (count > parseInt($("#stock").text())) {
		return floatNotify.simple('抱歉，您的购买量超过了库存了');
	}
	$.ajax({
		url: "{ZF::U('Product/addProductToCart',array('token'=>$token,'id'=>$product['id'],'wecha_id'=>$_GET['wecha_id']))}" + '&count='+count + '&did=' + did,
		success: function(data) {
			if(data){
				location.href = "{ZF::U('Product/cart',array('token' => $token,'wecha_id' => $_GET['wecha_id'], 'PHPSESSID' => session_id()))}";
			} else {
				return floatNotify.simple('抱歉，您的请求不正确');
			}
		}
	});
}
</script>

<script type="text/javascript">
function toLogin(){
	location.href="{ZF::U('Xiaoqu/People/login',array('token'=>$token,'re'=>urlencode($_SERVER['REQUEST_URI'])))}";
}
</script>


	<if condition="$kefu['sc'] eq '1'">
		<include file="footsrc"/>
	</if> 
	
	</div>
</div>
</div>
<div class="bottom_nav">
	
	 	<div style="line-height: 35px;margin-top:7px;">
		<ul>
			<a href="{ZF::U('Product/cart',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}">
				<li class=" glyphicon glyphicon-shopping-cart" style="float: left; /*border:1px solid #ccc;padding:8px;border-radius:4px;*/margin-left:10px;font-size:17px;color:#999;text-align:center;"><span style="display: block;font-size:12px;font-family: Helvetica,STHeiti STXihei, Microsoft JhengHei, Microsoft YaHei, Arial;margin-top:2px;color:#666;">购物车</span><i class="cart_com"><if condition="$totalProductCount neq 0" >{ZF:$totalProductCount}</if></i></li>
			</a>
			<li style="float: right;margin-right:10px;">
				<a href="javascript:;" onClick="<empty name="Think.get.wecha_id">toLogin()<else/>QuickBuy()</empty>" class="buynow">立即购买</a>&nbsp;
			
				<a href="javascript:;" id="btn_add_cart" class="addcart" onclick="<empty name="Think.get.wecha_id">toLogin()<else/>add_cart()</empty>">加入购物车</a>
			</li>
		</ul>
	</div>	
</div>
	
</body>
<script type="text/javascript">
window.shareData = {  
            "moduleName":"Product",
            "moduleID":"{ZF:$product['id']}",
            "imgUrl": "{ZF:$product['logourl']}", 
            "timeLineLink": "{ZF::C('site_url') .  U('Product/product',array('token' => $_GET['token']))}",
            "sendFriendLink": "{ZF::C('site_url') .  U('Product/product',array('token' => $_GET['token']))}",
            "weiboLink": "{ZF::C('site_url') .  U('Product/product',array('token' => $_GET['token']))}",
            "tTitle": "{ZF:$metaTitle}",
            "tContent": "{ZF:$metaTitle}"
        };
</script>
{ZF:$shareScript}

<script type="text/javascript"> 
window.onscroll = function(){ 
    var t = document.documentElement.scrollTop || document.body.scrollTop;  
    var top_div = document.getElementById( "top_div" ); 
    if( t >= 300 ) { 
        top_div.style.display = "inline"; 
    } else { 
        top_div.style.display = "none"; 
    } 
} 

</script> 
<div id="top_div">
	<a href="#top" style="background: url(/tpl/Wap/default/common/css/product/css/img/up.png) no-repeat top;background-color: rgba(0,0,0,0.48);padding:22px 5px 10px 5px;border-radius:30px;color:white;">顶部</a>
</div> 
<br /> 
<script type="text/javascript">
	var all_w=$('.detail-info').width();
	$(".views img").each(function(i){
		var img = $(this);
		var realWidth;//真实的宽度
		var realHeight;//真实的高度
		$("<img/>").attr("src", $(img).attr("src")).load(function() {
			realWidth = this.width;
			realHeight = this.height;
			if(realWidth>=all_w){
				$(img).css("width","100%").css("height","auto");
			}
			else{
				$(img).css("width",realWidth+'px').css("height",realHeight+'px');
			}
		});
	});
	
	$(window).resize(function(){
		var all_w=$('.detail-info').width();
		$(".views img").each(function(i){
			var img = $(this);
			var realWidth;//真实的宽度
			var realHeight;//真实的高度
			$("<img/>").attr("src", $(img).attr("src")).load(function() {
				realWidth = this.width;
				realHeight = this.height;
				if(realWidth>=all_w){
					$(img).css("width","100%").css("height","auto");
				}
				else{
					$(img).css("width",realWidth+'px').css("height",realHeight+'px');
				}
			});
		});
	})
	
	var win_width=$('.m-detail-mainout').width();
	$('.m-detail-mainout .focusPic').css("max-height",win_width+"px");
	$(window).resize(function(){
		var win_width=$('.m-detail-mainout').width();
		$('.m-detail-mainout .focusPic').css("max-height",win_width+"px");
	})
	
	
</script>

</html>