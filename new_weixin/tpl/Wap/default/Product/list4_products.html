<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="format-detection" content="telephone=no"/>
<title>{ZF:$metaTitle}</title>
<link href="tpl/Wap/default/common/list3_products/css/reset.css" rel="stylesheet" />

<link href="tpl/Wap/default/common/list3_products/css/glist.css" rel="stylesheet" />
<script src="tpl/Wap/default/common/list3_products/js/glist.js"></script>
<script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.js"></script>
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap-theme.css">
<script type="text/javascript" src="http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<!--  <script src="{ZF::$staticFilePath}/js/jquery-1.9.1.min.js" type="text/javascript"></script>-->
<style type="text/css">

a:hover{text-decoration: none;}
.pic img{width:100%;height:100%;};
.con{display: block;}
.con a{font-size:14px;color:#666;padding-left: 10px;padding-right: 5px;}
.con b{font-size:16px;color:red;}
.con del{font-size:14px;color:#ccc;padding-left: 5px;}
.img_box{overflow: hidden;height: 90px;width: 90px;float:left;}
.t{padding-top:0;display: block;height:30px;line-height: 30px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
.pro_box{padding:0 5px;background:#f1f1f1;}
//.pro_box:nth-child(2n){padding-right: 10px;padding-left:5px;}
.container{padding-left: 0;padding-right: 0;}
.sideBar ul li a.level1{padding-top:20px;font-size:16px;}
.sideBar ul li a{font-size:14px;}
.order_control{width:100%;background:#f8f8f8;-webkit-box-shadow: 0 3px 3px rgba(0,0,0,0.1);}
.order_control div{border-bottom:1px solid #ddd;line-height:40px;}
.order_control div a{color:#666;font-size:13px;font-family: '微软雅黑';}
.glist_header ul li span{height:auto;padding:0 8px;min-width:15px;  display: none;}
.glist_header ul li span a{width:auto;height:auto;}
.dropdown-menu a{padding-left: 15px;padding-right: 15px;}
.glyphicon-arrow-up:before{font-size:12px;float: right;padding-top:5px;}
.glyphicon-arrow-down:before{font-size:12px;float: right;padding-top:5px;}
.active{display:block;}
.dropdown-menu{position:static;}
.up div{border:none;background: url(/tpl/Wap/default/common/css/product/css/img/white_up.png) no-repeat top;height:22px;width:25px;display: inline-block;}
.arrow-up div{background: url(/tpl/Wap/default/common/css/product/css/img/up.png) no-repeat top;height:22px;width:25px;display: inline-block;border:none;}
.arrow-down div{background: url(/tpl/Wap/default/common/css/product/css/img/down.png) no-repeat top;height:22px;width:25px;display: inline-block;border:none;}


</style> 

<div data-role="container" class="container glist">
        <div class="rotate_body" style="overflow: hidden;">
            <header data-role="header">
                
                <div class="glist_header">
                    <ul class="tbox">
                        <li style="text-align: left;padding-top:8px;width: 40px;float:left;">
                            <span style="padding-left: 10px; display: inline-block;">
                                <a href="javascript:;" class="icon_list" onclick="glist_menuNav();" style="width:25px;height:25px;z-index: 20000"></a>
                            </span>
                        </li>
                        <li style="width:90%;float:right;text-align:left;line-height: 45px; " id="order_select">
                      	<div style="display: inline;cursor: pointer;" id="order_content" onclick="Show_Hidden(order_by)">
	                      	默认排序
	                      	<i class="glyphicon glyphicon-chevron-down" style="padding-left:5px;vertical-align: middle;"></i>
                      	</div>
                      </li>
                       		<span class="m-select c666 order_control" style="padding:0px;text-align:center;margin-top:45px;display:none;" id="order_by">
                        		<div><a href="javascript:" order="time"  style="/*background: none;*/border:none;" class="up">按时间排序<div></div></a></div>
                        		<div><a href="javascript:" order="salecount"  style="/*background: none;*/border:none;" class="up">按销量排序<div></div></a></div>
                        		<div><a href="javascript:" order="price"  style="/*background: none;*/border:none;" class="up">按价格排序<div></div></a></div>
                        		<div style="border-bottom:none;"><a href="javascript:" order="discount"  style="/*background: none;*/border:none;" class="up">按折扣排序<div></div></a></div>
                        	</span>
                    </ul>
                    
                 </div>
            </header>
            
            <div id="pro_content">
             <div id="m_list" class="m-list " style="overflow: hidden;">
				<volist name="products" id="hostlist"> 
					<div class="col-xs-12 pro_box">
						<div style="padding:10px;overflow: hidden;border:1px solid #ddd;background: white;margin-top:5px;">
							<span class="pic">
								<a href="{ZF::U('Product/product',array('token' => $_GET['token'], 'id' => $hostlist['id'], 'wecha_id' => $_GET['wecha_id']))}">
								<div class="img_box"><img src="{ZF:$hostlist.logourl}" data-original="{ZF:$hostlist.logourl}"></div>
								</a>
							</span>
							<span class="con">
								<a  class="t" href="{ZF::U('Product/product',array('token' => $_GET['token'], 'id' => $hostlist['id'], 'wecha_id' => $_GET['wecha_id']))}">{ZF:$hostlist.name}</a>
								<a  style="display: block;overflow: hidden;" href="{ZF::U('Product/product',array('token' => $_GET['token'], 'id' => $hostlist['id'], 'wecha_id' => $_GET['wecha_id']))}">
									<b>￥{ZF:$hostlist.price}</b><del>￥{ZF:$hostlist.oprice}</del>
									<span style="display:block;overflow: hidden;">库存：{ZF:$hostlist.num} </span>
									<span style="display:block;overflow: hidden;">邮费：<if condition="$hostlist.mailprice neq 0">￥{ZF:$hostlist.mailprice}<else/>包邮</if></span>
								</a>
							</span>
						</div>
					</div>
				</volist>
			</div>
			<div class="col-xs-12" style="text-align: center;background:#f1f1f1;">
				<a class="more" id="show_more" page="2" style="display: none;color:#666;margin-top:10px;margin-bottom: 10px;" href="javascript:void(0);">加载更多</a>
				<input type="hidden" value="1" id="pageid" />
				<input type="hidden" id="canScroll" value="1" />
			</div>
            
          </div>
          
          

            <footer data-role="footer">
                



            </footer>
        </div>
    </div>

    <!--分类导航菜单-->
    <div data-role="widget" data-widget="sideBar" class="sideBar" id="sideBar" onclick="glist_menuNav();">
        <div class="widget_wrap">
            <ul>
                <volist name="cats" id="vo">
                	<php>
				     if ($vo['parentid'] == 0){
				    </php>
				  		<li class="on"><a href="{ZF::U('Wap/Product/products',array('token'=>$token,'catid'=>$vo['id'],'wecha_id'=>$wecha_id))}" class="level1">{ZF:$vo.name}</a></li>
						<ol>
							<volist name="cats" id="vo2">
									  		
							<php>
								if ($vo2['parentid'] == $vo['id']){
							</php>
							 	<li><a href="{ZF::U('Wap/Product/products',array('token'=>$token,'catid'=>$vo2['id'],'wecha_id'=>$wecha_id))}">{ZF:$vo2.name}</a></li>
							<php>
							}
							</php>
							
									  		
							</volist>
						</ol>
				  	<php>
				  	}
				  	</php>
				</volist>
				
                
                
            </ul>
        </div>
    </div>




<script type="text/javascript">

/*开始！设置列表模板的高度
var limit_img_box=function(){
	var img_h=$('.img_box').width();
	$('.img_box').css("height",img_h+"px");
}
limit_img_box();

$(window).resize(function(){
	limit_img_box();
})
/*结束！设置列表模板的高度*/



$(function() {
	$('#search_form').submit(function() {
		var search_name = $('#search_name').val();
		if (search_name == '') {
			return false;
		}
	});

	//点击排序
	var base_url = '{ZF::U('Product/products',array('token'=>$_GET['token'],'catid'=>$thisCat['id'],'wecha_id'=>$_GET['wecha_id']))}';
	var b_url = '<if condition="$isSearch neq 1">{ZF::U('Product/ajaxProducts',array('token'=>$_GET['token'],'catid'=>$thisCat['id'],'wecha_id'=>$_GET['wecha_id']))}<else/>{ZF::U('Product/ajaxProducts',array('token'=>$_GET['token'],'keyword'=>$_GET['keyword'],'wecha_id'=>$_GET['wecha_id']))}</if>'
	method = 'DESC',
		_get_method = '{ZF:$method}',
		order = '{ZF:$order}',
		_get_order  = '';
	if (_get_order != '') {
		order = _get_order;
	}
	$('.order_control a').removeClass('arrow-down');
	if (_get_method == 'DESC')  {
		method = 'ASC';
		$('.order_control a[order="' + order + '"]').addClass('arrow-up');
	} else {
		$('.order_control a[order="' + order + '"]').addClass('arrow-down');
	}
	$('.order_control a').click(function() {
		var order = $(this).attr('order');
		var url = base_url + '&order=' + order+'&method='+method;
		location.href = url;
	});
	

	/*---------------------加载更多--------------------*/
	var total = {ZF:$count},
		pagesize = 8,
		pages = Math.ceil(total / pagesize);

	//alert(total);
	var com_link = '{ZF::U('Product/product',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id']))}';
	var label_arr = ["\u8bf7\u9009\u62e9\u6807\u7b7e","\u70ed\u5356","\u7206\u6b3e"];
	if (pages > 1) {
		var _page = $('#show_more').attr('page');
		$(window).bind("scroll",function() {
			if ($(document).scrollTop() + $(window).height() >= $(document).height()) {
				if (_page > pages) {
					$('#show_more').show().html('没有更多了').delay(2300).slideUp(1600);
					return;
				}
				$('#show_more').show().html('<img src="/tpl/Wap/default/common/shop/images/loading.jpg" style="height:30px;width:auto;">');
				if($('#canScroll').val()==0){//不要重复加载
					return;
				}
				$('#canScroll').attr('value',0);
				$.ajax({
					type : "GET",
					data : {'page' : _page, 'inajax' : 1},
					url :  b_url + '&order=' + order + '&method=' + _get_method + '&pagesize='+pagesize,
					dataType : "json",
					success : function(RES) {console.log(RES);
						$('#canScroll').attr('value',1);
						$('#show_more').hide().html('加载更多');
						data = RES.products;
						if(data.length){
							$('#show_more').attr('page',parseInt(_page)+1);
						}
						_page = $('#show_more').attr('page');
						var _tmp_html = '';
						$.each(data, function(x, y) {
							var mail_price=y.mailprice;
							if(mail_price==0){
								mail_price="包邮";
							}else{
								mail_price="￥"+y.mailprice;
							}
							_tmp_html += '<div class="col-xs-12 pro_box">'+
											'<div style="padding:10px;overflow: hidden;border:1px solid #ddd;background: white;margin-top:5px;">'+
												'<span class="pic">' +
													'<a href="' + com_link + '&id=' + y.id + '">' +
														'<div class="img_box"><img src="' +y.logourl + '" /></div>' +
													'</a>'+
												'</span>'+
												'<span class="con">'+
													'<a class="t" href="' + com_link + '&id=' + y.id + '">' +y.name + '</a>'+
													'<a style="display: block;overflow: hidden;" href="' + com_link + '&id=' + y.id + '">'+
														'<b>￥'+ y.price +'&nbsp;元</b>'+
														'<del>￥' + y.oprice + '</del>'+
														'<span style="display:block;overflow: hidden;">库存：'+y.num+'</span>'+
														'<span style="display:block;overflow: hidden;">邮费：'+mail_price+'</span>'+
													'</a>'+
												'</span>'+
											'</div>'+
										'</div>';
						});
						$('#m_list').append(_tmp_html); 
						
						/*开始！设置列表模板的高度
							
						limit_img_box();
					
						/*结束！设置列表模板的高度*/
				
						
					}
				});
			}
		});
	}
});
</script>

		<if condition="$kefu['sc'] eq '1'">
		<include file="footsrc"/>
		</if> 
</body>
<script type="text/javascript">
window.shareData = {  
            "moduleName":"Product",
            "moduleID":"{ZF:$products[0]['id']}",
            "imgUrl": "{ZF:$products[0]['logourl']}", 
            "timeLineLink": "{ZF::C('site_url') .  U('Product/products',array('token' => $_GET['token']))}",
            "sendFriendLink": "{ZF::C('site_url') .  U('Product/products',array('token' => $_GET['token']))}",
            "weiboLink": "{ZF::C('site_url') .  U('Product/products',array('token' => $_GET['token']))}",
            "tTitle": "{ZF:$metaTitle}",
            "tContent": "{ZF:$metaTitle}"
        };
</script>
<script type="text/javascript">
/*--开始！设置正文内容板块的高度与宽度--*/
var w_height=$(window).height();
$('.rotate_body').css("min-height",w_height+"px");

$('.container').resize(function(){
	var w_height=$(window).height();
	$('.rotate_body').css("min-height",w_height+"px");
	
	 
})
/*--结束！设置正文内容板块的高度与宽度--*/


/*-----设置排序标题的位置-----*/
var win_w=$(window).width();
var ord_w=$('#order_content').width();
$('#order_select').css("width",win_w-40+"px");

$('#order_select').css("padding-left",(win_w-ord_w-80)/2+"px");
$(window).resize(function(){
	var win_w=$(window).width();
	var ord_w=$('#order_content').width();
	$('#order_select').css("width",win_w-40+"px");

	$('#order_select').css("padding-left",(win_w-ord_w-80)/2+"px");
})

/*-----排序点击显示与隐藏-----*/
function Show_Hidden(order_by){
    if(order_by.style.display=="block"){
    	order_by.style.display='none';
    }else{
    	order_by.style.display='block';
    }
}



</script>

{ZF:$shareScript}
<!--pre>
< php>
print_r($cats); 
</php>
</pre -->
</html>