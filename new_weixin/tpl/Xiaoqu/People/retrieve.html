<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>你正在找回密码</title>
<script type="text/javascript" src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
</head>
<body>


<h3>找回密码</h3>
<div>{ZF:$error}</div>
<form method="post">

手机号：<input type="tel" name="phone" id="phone"><input type="button" id="getcode_btn" value="发送验证码到手机"><br>
验证码：<input type="text" name="code" onchange="checkcode(this.value);">
<span id="checkcode_rs"></span><br>

<input type="submit" value="找回密码"> 

</form>
<p>你可以去<a href="/">首页</a> 或者 <a href="{ZF::U('login')}">重新登录</a></p>

<script type="text/javascript">
function getcode(){
	$(this).attr('disabled',true);
	var btn = this;
	var btn_value_bak = btn.value;
	
	$.get('{ZF::U('Xiaoqu/People/getcode')}',{phone:$('#phone').val()},
	  function(data){
		btn.value = data;
	  });
	//开始倒数
	var sec = 60;	
	function countsec(){
    	btn.value = sec+"秒后可以重新发送验证码";
    	sec--;
    	if (sec > 0){
    		setTimeout(countsec,1000);
    	}else{
    		btn.value = btn_value_bak;
    		$(btn).attr('disabled',false);
    	}
    }
	
	setTimeout(countsec, 1000);
	
}

function checkcode(code){
	$.get('{ZF::U('Xiaoqu/People/checkcode')}',
			  function(data){
			    if (data == code) {
			    	$('#phone').attr('readonly',true);
			    	$('#checkcode_rs').html('<span style="color:green;">填写正确</span>');
			    }
			    else  $('#checkcode_rs').html('<span style="color:red;">验证码不正确</span>');
			  });
}


<include file="Public:footer"/>
$("#getcode_btn").bind("click",getcode);
</script>

</body>
</html>