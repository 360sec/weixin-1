<php>$PageTitle = '注册';
$TPAuth = session('TPAuth');
if (!empty($TPAuth)){
    //print_r($TPAuth);
	$PageTitle = '手机验证';
}
</php>
<include file="Public:header"/>
<div class="container"  id="page_name" style="padding:0;">
	<span class="col-xs-3 back"><a href="" onclick="window.history.back()"><span class="glyphicon glyphicon-menu-left"></span></a></span>
	<span class="col-xs-6 page_title">{ZF:$PageTitle}</span>
	<span class="col-xs-3 res_link"></span>
</div>
<div class="col-xs-12" style=" color:red;text-align:center;font-size:14px;height:30px;line-height: 30px;">{ZF:$error}</div>
<div style="font-size:14px;text-align: center;">
	<span id="checkcode_rs" style="height:30px;line-height: 30px;" ></span>
</div>
<div style="font-size:14px;text-align: center;">
	<span id="checkpw_rs" style="height:30px;line-height: 30px;"></span>
</div>
<form method="post"> 
	<div class="container" id="page_box" style="height:auto;">
		<div class="page">
		    <div class="page-msg">
				<div class="col-xs-3 page-msg-name">昵　称</div>
				<div class="col-xs-9 page-msg_input"><input type="text" name="name" id="name" placeholder="给自己起个名字吧" style="border:none;width:100%;height: 42px;"<php>
					if (!empty($TPAuth)) {
						if ($TPAuth['vendor']=='qq') echo ' value="'.$TPAuth['info']->nickname.'"';
						elseif ($TPAuth['vendor']=='weibo') echo ' value="'.$TPAuth['info']->screen_name.'"'; 
					}
				</php>></div>
			</div>
			<div class="page-msg">
				<div class="col-xs-3 page-msg-name">手机号</div>
				<div class="col-xs-9 page-msg_input"><input type="tel" name="phone" id="phone" placeholder="手机号码将用于登录" style="border:none;width:100%;height: 42px;"></div>
			</div>
			<div class="page-msg">
				<div class="col-xs-3 page-msg-name">验证码</div>
				<div class="col-xs-5 page-msg_input"><input type="text" name="code" onchange="checkcode(this.value);" placeholder="请输入手机收到的验证码 ->" height="40px" style="border:none;width:100%;height: 42px;"></div>
				<div class="col-xs-4" style="line-height: 42px;padding-left:5px;padding-right: 0px;text-align: right;background: white;height:42px;overflow: hidden;"><input type="button" id="getcode_btn" value="获取验证码" style="color:white;font-size:14px;height:42px;border: none;background: #ea9093;padding-left:5px;padding-right: 5px;text-align: center;"></div>
			</div>
			<!--  <div class="alert_msg">
				<div class="col-xs-3"></div>
				<div class="col-xs-9"><span id="checkcode_rs" style="height:30px;font-size: 14px;line-height: 30px;"></span></div>
			</div>-->
			<div<php>
					if (!empty($TPAuth)) {
						echo ' style="display:none;"';
					}
				</php>>
			<div class="page-msg">
				<div class="col-xs-3 page-msg-name">登录密码</div>
				<div class="col-xs-9 page-msg_input"><input type="password" name="password" id="password" placeholder="请输入密码" style="border:none;width:100%;height: 42px;"></div>
			</div>
			<div class="page-msg">
				<div class="col-xs-3 page-msg-name">确认密码</div>
				<div class="col-xs-9 page-msg_input"><input type="password" name="password_c" onchange="checkpw(this.value,'password','checkpw_rs');" placeholder="请确认密码" style="border:none;width:100%;height: 42px;"></div>
			</div>
			</div>
		</div>
		<div class="col-xs-12 page-but">
			<input type="submit" value="注册" style="background:#f95a60;/*background-image: url(/tpl/Wap/default/common/Index/xq1/toolbar_bg.png);background-repeat:repeat-x;*/width:100%;border:0;box-shadow:0px 1px 1px 0px;font-size:20px;color:white;height:40px;border-radius:4px;" >
		</div>
	</div>
</form>
<div class="col-xs-12" style="/*position:fixed;bottom:30px;*/padding:10px 0 10px 0 ;color:black;text-align:center;font-size:14px;">
<a href="#" id="qqlogin"><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Connect_logo_4.png"></a><br>
<a href="#" id="wblogin"><img src="http://img.t.sinajs.cn/t4/appstyle/open/images/website/loginbtn/loginbtn_02.png"></a><br>
<br><br>
已是会员?&nbsp;&nbsp;<a href="<empty name='Think.get.re'>{ZF::U('Xiaoqu/People/login',array('token'=>$_GET['token']))}<else/>{ZF::U('Xiaoqu/People/login',array('token'=>$_GET['token'],'re'=>urlencode($_GET['re']) ))}</empty>">直接登录</a>
</div>
<script>
$('#qqlogin').click(function(){
	var login_func = function ()
	 {
		   //以下为按钮点击事件的逻辑。注意这里要重新打开窗口
		   //否则后面跳转到QQ登录，授权页面时会直接缩小当前浏览器的窗口，而不是打开新窗口
		   location.href="{ZF::U('Xiaoqu/People/qqlogin')}";
		 };
	login_func();
});
$('#wblogin').click(function(){
	var login_func = function ()
	 {
		   //以下为按钮点击事件的逻辑。注意这里要重新打开窗口
		   //否则后面跳转到QQ登录，授权页面时会直接缩小当前浏览器的窗口，而不是打开新窗口
		   location.href="{ZF::U('Xiaoqu/People/wblogin')}";
		 };
	login_func();
});
</script>
<!--  
<div class="container">
	<div id="res_title" style="width:auto;">
		<span style="padding-left:0;">注册</span>
	</div>
</div>
<div class="container"  id="res">
	<form method="post">
		<table  class="res-box">
			<tr>
				<td colspan="2" style="color:red;text-align:center;font-size:14px;">{ZF:$error}</td>
			</tr>
			<tr>
				<td style="text-align:center;">手机号：</td>
				<td style="text-align:left;"><input type="tel" name="phone" id="phone" placeholder="请填写手机号码" height="40px"></td>
			</tr>
			<tr>
				<td></td>
				<td style="text-align:left;"><input type="button" id="getcode_btn" value="发送验证码到手机"></td>
			</tr>
			<tr>
				<td style="text-align:center;">验证码：</td>
				<td style="text-align:left;"><input type="text" name="code" onchange="checkcode(this.value);" placeholder="请输入验证码" height="40px" width="100%"></td>
				
			</tr>
			<tr>
				<td></td>
				<td style="text-align: left;"><span id="checkcode_rs"  ></span></td>
			</tr>
			<tr>
				<td style="text-align:center;">登录密码：</td>
				<td style="text-align:left;"><input type="password" name="password" id="password" placeholder="请输入密码" height="40px" width="100%"></td>
			</tr>
			<tr>
				<td style="text-align:center;">确认密码：</td>
				<td style="text-align:left;"><input type="password" name="password_c" onchange="checkpw(this.value,'password','checkpw_rs');" placeholder="请确认密码" height="40px" width="100%"></td>
			</tr>
			<tr>
				<td></td>
				<td align="left"><span id="checkpw_rs"></span></td>
			</tr>
		</table>
		<table class="res-but">
			<tr style="text-align:center;">
				<td><input type="submit" value="注册" style="background-image: url(/tpl/Wap/default/common/Index/xq1/toolbar_bg.png);width:300px;height:35px;border:0;box-shadow:0px 1px 1px 0px;font-size:16px;color:white;font-weight:bold;" id="inp_w"></td>
			</tr>
		</table>
		
	</form>
	
	<div style="text-align:center;margin-bottom:20px;margin-top:20px;">
		你可以去<!-- a href="{ZF::U('Index/index')}">首页</a--> <!--<a href="<empty name='Think.get.re'>{ZF::U('Xiaoqu/People/login',array('token'=>$_GET['token']))}<else/>{ZF::U('Xiaoqu/People/login',array('token'=>$_GET['token'],'re'=>urlencode($_GET['re']) ))}</empty>">登录</a>
	 </div>
</div>
-->
<script type="text/javascript">
var w=$('.res-box').width();
$('#inp_w').css("width",w+"px");
$('#res_title').css("width",w+"px");  
$(window).resize(function(){	
	
	var ww=$(window).width();
	if(ww<=320){
		var w=$('.res-box').width();
		$('#inp_w').css("width",w+"px");
		$('#res_title').css("width",w+10+"px");
		
	}else{
		var w=$('.res-box').width();
		$('#inp_w').css("width",w+30+"px");
		$('#res_title').css("width",w+30+"px");
	}
})
</script>

<script type="text/javascript">
function getcode(){
	$(this).attr('disabled',true);
	var btn = this;
	var btn_value_bak = btn.value;
	
	$.get('{ZF::U('Xiaoqu/People/getcode',array('token'=>$_GET['token']))}',{phone:$('#phone').val()},
	  function(data){
		btn.value = data;
	  });
	//开始倒数
	var sec = 60;	
	function countsec(){
    	btn.value = sec+"秒后重新发送验证码";
    	sec--;
    	if (sec > 0){
    		setTimeout(countsec,1000);
    	}else{
    		btn.value = btn_value_bak;
    		$(btn).attr('disabled',false);
    	}
    }
	
	setTimeout(countsec, 1000);
	
}

function checkcode(code){
	$.get('{ZF::U('Xiaoqu/People/checkcode',array('token'=>$_GET['token']))}',
			  function(data){
			    if (data == code) {
			    	$('#phone').attr('readonly',true);
			    	$('#checkcode_rs').html('<span style="color:green;" class="glyphicon glyphicon-ok">验证码输入正确</span>');
			    	
			    }
			    else  $('#checkcode_rs').html('<span style="color:red;" class="glyphicon glyphicon-remove">验证码输入不正确</span>');
			  });
}

function checkpw(value,domid,msgid){
	if (value == $('#'+domid).val()) $('#'+msgid).html('<span style="color:green;" class="glyphicon glyphicon-ok">密码正确</span>');
	else $('#'+msgid).html('<span style="color:red;" class="glyphicon glyphicon-remove">两次密码输入不一致</span>');
}


$("#getcode_btn").bind("click",getcode);
</script>


<!--  <include file="Public:footer"/>-->