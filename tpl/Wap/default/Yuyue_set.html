<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">	
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="{lanrain::RES}/css/yuyue/onlinebooking.css" media="all" />
<link rel="stylesheet" type="text/css" href="{lanrain::RES}/css/yuyue/datepicker.css" media="all" />
<link rel="stylesheet" type="text/css" href="{lanrain::RES}/css/yuyue/weimob-ui-1-1.css" media="all" />
<link rel="stylesheet" type="text/css" href="{lanrain::RES}/css/yuyue/common.css" media="all" />
<script type="text/javascript" src="{lanrain::RES}/js/yuyue/jQuery.js"></script>
<script type="text/javascript" src="{lanrain::RES}/js/yuyue/jquery-ui.js"></script>
<title>修改预约</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<!-- Mobile Devices Support @begin -->
<meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
<meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
<meta content="no-cache" http-equiv="pragma">
<meta content="0" http-equiv="expires">
<meta content="telephone=no, address=no" name="format-detection">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta name="apple-mobile-web-app-capable" content="yes" /> <!-- apple devices fullscreen -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<!-- Mobile Devices Support @end -->
<link rel="shortcut icon" href="img/favicon.ico" />
<style>
img{width:100%!important;}
</style>
</head>
<body onselectstart="return true;" ondragstart="return false;">
<div class="qiandaobanner"> 
<a href="{lanrain::U('Yuyue/index',array('token'=>$token ,'wecha_id'=>$wecha_id,'id'=>$yuyue[id]))}"  ><img src="<if condition="$yuyue.topic neq false">{lanrain:$yuyue.topic}<else/> {lanrain::RES}/images/yuyue/head_pic.jpg</if> "/></a>
</div>
<div class="cardexplain">
<!--粉丝填写过的信息的，直接就显示名字电话，粉丝没有填写过信息的话，这里就直接留空让粉丝填写-->
<ul class="round">
<form action="javascript:" method="post">
<li class="title mb">
<span>预约详情<em class="no"><if condition="$vo.type eq 0">等待客服回电<else/> 已受理</if></em></span>
</span>
</li>
<li class="nob">
<div class="beizhu">此订单可重新修改后再提交！</div>
</li>
<li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
    <th>订单人</th>
    <td>
        <input name="name" class="px" id="name" value="{lanrain:$order.name}" placeholder="请输入您的真实姓名" type="text">
    </td>
</tr>
</table>
</li>
        <li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
    <th>联系电话</th>
    <td>
        <input name="phone" class="px" id="phone" value="{lanrain:$order.phone}" placeholder="请输入您的电话" type="tel">
    </td>
</tr>
</table>
</li>
<li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<th>人数</th>
<td><input name="num" class="px" id="num" value="{lanrain:$order.num}" placeholder="请输入人数" type="text"></td>
</tr>
</table>
</li>
        <li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
    <th>预约日期</th>
    <td>
        <input type="text" class="px" name="date" id="date" readonly value="{lanrain:$order['date'] | date="Y-m-d",###}"/>
    </td>
</tr>
</table>
</li>
        <li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<th>预约时间</th>
<td>
<select name="time_hour" id="time_hour" class="dropdown-select" style="width:30%;float:left;">
<for start="1" end="25">
<option value="{lanrain:$i|sprintf="%02d",###}" <if condition='date("H",$order[date]) eq sprintf("%02d",$i)'>selected</if>>{lanrain:$i|sprintf="%02d",###}时</option>
</for>
</select>
<select name="time_second" id="time_second" class="dropdown-select" style="width:30%;float:left; margin-left:10px;">
<for start="0" end="7">
<option value="{lanrain:$i|sprintf="%d0",###}" <if condition='date("i",$order[date]) eq sprintf("%d0",$i)'>selected</if>>{lanrain:$i|sprintf="%d0",###}分</option>
</for>
</select>
</td>
</tr>
</table>
</li>

                  
        <li class="nob">
<table class="kuang" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
    <th class="thtop" valign="top">备注</th>
    <td>
<textarea name="memo" class="pxtextarea" value="{lanrain:$order.memo}"  style="height:99px;overflow-y:visible" id="memo" placeholder="请输入备注信息">{lanrain:$order.memo}</textarea>
<input type="hidden" name="wecha_id" id="wecha_id" value="{lanrain:$wecha_id}" />
<input type="hidden" name="rid" id="id" value="{lanrain:$order.id}" />
    </td>
</tr>
</table>
</li>
</form>
</ul>	
<div class="footReturn">
<ul>
<li class="footerbtn"><a id="showcard2" class="del right3" href="javascript:void(0)">删除信息</a></li>
<li class="footerbtn"><a id="showcard" class="submit left3" style="color:#fff;" href="javascript:void(0)">提交修改</a></li>
</ul>
<div class="clr"></div>
<div class="window" id="windowcenter">
<div id="title" class="wtitle">操作成功<span class="close" id="alertclose"></span></div>
<div class="content">
<div id="txt"></div>
</div>
</div>
</div>

</div>

<script type="text/javascript"> 
$(document).ready(function () {
    $( "#date" ).datepicker({
        minDate: new Date(),
        dateFormat: "yy-mm-dd"
    });
	//提交信息
	$("#showcard").click(function () {
		var tel_num =num= '';
		if($("#num").val()==''){alert('人数不能为空');return;} 
		tel_num = $("#phone").val();
		if('undefined' !== typeof(tel_num)){
			if(tel_num ==''){alert('电话不能为空');return;} 
			if(tel_num.length < 11){alert('请输入正确的电话');return;} 
		}
	
		if($("#name").val()==''){alert('名字不能为空');return;}
		if($("#date").val()==''){alert('请选择时间');return;}
		var submitData = {
			wechaid: $("#wecha_id").val(),
			id: $("#id").val(),
			name: $("#name").val(),
			num: $("#num").val(),
			date: $("#date").val()+" "+$("#time_hour").val()+":"+$("#time_second").val()+":00",
			timepart: $("#timepart").val(),
			memo: $("#memo").val(),
			phone: $("#phone").val()
		};
		if('fromUsername' == submitData.wechatid) submitData.wechatid = '';
		$.post("{lanrain::U('Yuyue/edit',array('token'=>$token,'wecha_id'=>$wecha_id))}", submitData,
			function(data) {
				if (1 == data) {
					alert("提交成功！");
					setTimeout(function(){
						window.location.href="{lanrain::U('Yuyue/order',array('token'=>$token,'wecha_id'=>$wecha_id,'id'=>$yuyue['id']))}";
					},1500);
					return;
				} else {
					alert("提交失败");
				}
		})
	}); 
	//删除信息
	$("#showcard2").click(function () {
		var submitData2 = {
			wechaid: $("#wecha_id").val(),
			id: $("#id").val()
		};
		$.post("{lanrain::U('Yuyue/del',array('token'=>$token,'wecha_id'=>$wecha_id))}", submitData2,
			function(data) {
				if (1 == data) {
					alert("删除成功！");
					setTimeout(function(){
						window.location.href="{lanrain::U('Yuyue/order',array('token'=>$token,'wecha_id'=>$wecha_id,'id'=>$yuyue['id']))}";
					},1500);
					return;
				} else {
					alert("删除失败");
				}
		})
	}); 
	$("#alertclose").click(function () { 
		$("#windowcenter").slideUp(500);
	}); 

	function alert(title){ 
		$("#windowcenter").slideToggle("slow"); 
		$("#txt").html(title);
	}
}); 
</script> 
<div mark="stat_code" style="width:0px; height:0px; display:none;"></div>
</body>
</html>